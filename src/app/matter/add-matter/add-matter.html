<!-- CONTENT SECTION-->
<div class="container-fluid">
    <div id="wrapper">
        <div class="page-title-border clearfix  matter-progress-bar ">
            <h2 class="pull-left page-title margin-top15px">{{addCtrl.pageTitle}}</h2>

            <div class="pull-right margin-top10px">

                <button data-ng-click="addCtrl.cancel()" class="btn btn-default btn-styleNone">Cancel</button>
                <button data-ng-click="addCtrl.save(addCtrl.matterInfo)" data-request-pending="addCtrl.saving" data-ng-disabled="(addCtrl.isGraceOver == 0) || (addCtrl.addMatterFrm.$invalid || addCtrl.addJurisdiction.$invalid || addCtrl.isDatesValid())"
                    class="btn btn-default" id="saveButton">
                    Save
                </button>
            </div>
            <div class="pull-right progress-bar-outer">
                <div class="progress-wrapper text-center">
                    <round-progress max="addCtrl.maxMatter" current="addCtrl.usedMatters" color="{{addCtrl.graphColor}}" bgcolor="#eaeaea" radius="27"
                        stroke="5" semi="false" rounded="true" clockwise="true" responsive="false" duration="800" animation="easeInOutQuart"
                        animation-delay="0"></round-progress>
                    <div class="123 percentage-bar">{{addCtrl.hostingCapacity}}%</div>
                </div>
                <span class="hosting-title">Hosting Capacity</span>
            </div>
        </div>
        <div>
            <div class="addmatter-form dashboard-tasks-due addmatter-form-height">
                <div>
                    <div class="row margin-top10px">
                        <div class="col-lg-12 col-md-12" data-ng-form="addCtrl.addMatterFrm">
                            <label>
                                Matter Name
                                <span class="compulsary-mark">*</span>
                            </label>
                            <input data-ng-model="addCtrl.matterInfo.matter_name" name="matter_name" type="text" class="form-control " data-ng-required="true" maxlength="250"
                            />
                            <span class="sprite default-caution error-icon" data-ng-show="addCtrl.addMatterFrm.matter_name.$dirty && addCtrl.addMatterFrm.matter_name.$invalid"></span>
                            <div data-ng-if="addCtrl.addMatterFrm.matter_name.$dirty" ng-messages="addCtrl.addMatterFrm.matter_name.$error">
                                <div class="error" ng-message="required">
                                    Matter name is required
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="row  margin-top10px ">
                        <div class="col-lg-2 col-md-2 ">
                            <label>Date of Incident</label>
                            <div class="input-group datepicker">
                                <input type="text" class="form-control" datepicker-popup="MM/dd/yyyy" max-date="addCtrl.maxdate" data-ng-model="addCtrl.matterInfo.dateofincidence"
                                    is-open="addCtrl.openDoi" data-ng-disabled="false" id="incidentDatediv" validate-date error-div="#incidentDatediv"
                                    tooltip="mm/dd/yyyy" placeholder="mm/dd/yyyy" name="doi" close-text="Close" show-button-bar="false"/>
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-default" ng-click="addCtrl.openCalender($event);addCtrl.openDoi = true;addCtrl.openDointake=false;addCtrl.retainerDate = false">
                                        <i class="default-calendar-small sprite"></i>
                                    </button>
                                </span>
                            </div>
                            <div class="error" id="incidentDateError">Invalid date format!</div>
                        </div>
                        <div class="col-lg-2 col-md-2">
                            <label>Date of Intake</label>
                            <div class="input-group datepicker">
                                <input type="text" class="form-control" datepicker-popup="MM/dd/yyyy" max-date="addCtrl.maxdate" data-ng-model="addCtrl.matterInfo.date_of_intake"
                                    is-open="addCtrl.openDointake" data-ng-disabled="false" name="doi" id="intakeDatediv" validate-date
                                    error-div="#intakeDatediv" tooltip="mm/dd/yyyy" placeholder="mm/dd/yyyy" close-text="Close" show-button-bar="false"
                                />
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-default" ng-click="addCtrl.openCalender($event);addCtrl.openDointake = true;addCtrl.openDoi = false;addCtrl.retainerDate = false">
                                        <i class="default-calendar-small sprite"></i>
                                    </button>
                                </span>
                            </div>
                            <div class="error" id="intakeDateError">Invalid date format!</div>
                        </div>
                        <div class="col-lg-3 col-md-3">
                            <label>Location of Incident</label>
                            <input data-ng-model="addCtrl.matterInfo.accident_location" type="text" class="form-control" maxlength="200">
                        </div>
                        <div data-ng-if="addCtrl.isCustomFileNumber==1">
                            <div class="col-lg-2 col-md-2">
                                <label>Matter File#</label>
                                <input data-ng-model="addCtrl.matterInfo.file_number" type="text" name="file_number" class="form-control">

                                <div data-ng-if="addCtrl.addMatterFrm.file_number.$dirty" ng-messages="addCtrl.addMatterFrm.file_number.$error">
                                    <div class="error" ng-message="pattern">
                                        Accepts only number
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-3">
                            <label>Index/Docket#</label>
                            <input data-ng-model="addCtrl.matterInfo.index_number" type="text" name="index_number" class="form-control" maxlength="55">
                            <div data-ng-if="addCtrl.addMatterFrm.index_number.$dirty" ng-messages="addCtrl.addMatterFrm.index_number.$error">
                                <div class="error" ng-message="pattern">
                                    Accepts only number
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>

                </div>

                <div class="clearfix"></div>
                <div class="row ">
                    <div class=" col-lg-12 col-md-12 margin-top10px">
                        <label>Matter Summary</label>
                        <text-angular ta-toolbar="[['bold','italics','strikeThrough','underline'],
                         ['justifyLeft','justifyCenter','justifyRight'],['ul', 'ol']]" ng-model="addCtrl.matterInfo.summary"
                            class="small-textarea">
                        </text-angular>
                    </div>

                </div>
                <div class="row">
                </div>
                <div class="clearfix"></div>
                <div class="clearfix"></div>
                <div class="row  ">


                    <div class="col-lg-3 col-md-3 margin-top10px">
                        <label>Type</label>

                        <ui-select ng-model="addCtrl.matterInfo.matter_type_id" on-select="addCtrl.getMatterSubtype(addCtrl.matterInfo.matter_type_id);addCtrl.typeChanged(addCtrl.matterInfo.matter_type_id);"
                            theme="selectize">
                            <ui-select-match placeholder="Select Type">
                                {{$select.selected.label}}
                            </ui-select-match>
                            <ui-select-choices repeat="type.value as type in addCtrl.matterTypes| filter:{label:$select.search} | orderBy: 'label'">
                                <small>
                                    {{type.label}}
                                </small>
                            </ui-select-choices>
                        </ui-select>


                        <!--<clx-btn-group
                            btn-list="addCtrl.matterTypes"
                            btn-click="addCtrl.getMatterSubtype"
                            value="addCtrl.matterInfo.matter_type_id"></clx-btn-group>-->
                    </div>

                    <div class="col-lg-3 col-md-3 margin-top10px">
                        <label>Subtype</label>
                        <ui-select ng-model="addCtrl.matterInfo.matter_sub_type_id" theme="selectize">
                            <ui-select-match placeholder="Select Subtype...">
                                {{$select.selected.name}}
                            </ui-select-match>
                            <ui-select-choices repeat="subtype.id as subtype in addCtrl.subType| filter:{name:$select.search} | orderBy: 'name'">
                                <small>
                                    {{subtype.name}}
                                </small>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="col-lg-3 col-md-3 margin-top10px" data-ng-if="addCtrl.categoryList.length > 0">
                        <label>Category</label>
                        <ui-select ng-model="addCtrl.matterInfo.matter_category_id" theme="selectize">
                            <ui-select-match placeholder="Select Category...">
                                {{$select.selected.name}}
                            </ui-select-match>
                            <ui-select-choices repeat="category.id as category in addCtrl.categoryList| filter:{name:$select.search} | orderBy: 'name'">
                                <small>
                                    {{category.name}}
                                </small>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="col-lg-3 col-md-3 margin-top10px" data-ng-if="addCtrl.lawTypeList.length>0">
                        <label>Law Type</label>
                        <ui-select ng-model="addCtrl.matterInfo.law_type_id" theme="selectize">
                            <ui-select-match placeholder="Select Law Type...">
                                {{$select.selected.name}}
                            </ui-select-match>
                            <ui-select-choices repeat="lawtype.id as lawtype in addCtrl.lawTypeList| filter:{name:$select.search} | orderBy: 'name' ">
                                <small>
                                    {{lawtype.name}}
                                </small>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    
                </div>
                <div class="row">

                    <div class="col-lg-6 col-md-6 margin-top10px ">
                        <label>Status</label>

                        <ui-select ng-model="addCtrl.matterInfo.matter_status_id" on-select="addCtrl.getSubstatus(addCtrl.matterInfo.matter_status_id);"
                            theme="selectize">
                            <ui-select-match placeholder="Select Status">
                                {{$select.selected.label}}
                            </ui-select-match>
                            <ui-select-choices repeat="status.value as status in addCtrl.statuses| filter:{label:$select.search} ">
                                <small>
                                    {{status.label}}
                                </small>
                            </ui-select-choices>
                        </ui-select>


                        <!--<clx-btn-group
                                btn-list="addCtrl.statuses"
                                btn-click="addCtrl.getSubstatus"
                                value="addCtrl.matterInfo.matter_status_id"></clx-btn-group>-->
                    </div>

                    <div class="col-lg-6 col-md-6 margin-top10px">
                        <label>Substatus</label>
                        <ui-select ng-model="addCtrl.matterInfo.sub_status_id" theme="selectize">
                            <ui-select-match placeholder="Select Substatus...">
                                {{$select.selected.name}}
                            </ui-select-match>
                            <ui-select-choices repeat="item.id as item in addCtrl.subStatus| filter:{name:$select.search}">
                                <small>
                                    {{item.name}}
                                </small>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                </div>


                <div data-ng-if="addCtrl.display.importantDates" class=" col-md-9 margin-top10px padding-left-0">
                    <important-dates dates="addCtrl.matterInfo.importantdates" class="impDates borderTop row">
                    </important-dates>

                </div>
                <!--US#8309 add retainer date and retainer number-->
                <!-- <div class="col-md-3" style="margin-top: 60px;">
                    <label>Retainer Date</label>
                    <div class="input-group datepicker datepicker-left-align">
                        <input type="text" class="form-control" datepicker-popup="MM/dd/yyyy" max-date="addCtrl.maxdate" data-ng-model="addCtrl.matterInfo.retainer_date"
                            is-open="addCtrl.retainerDate" data-ng-disabled="false" name="retainerDate" id="retainerDate" validate-date
                            error-div="#retainerDate" tooltip="mm/dd/yyyy" placeholder="mm/dd/yyyy" close-text="Close" />
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-default" ng-click="addCtrl.openCalender($event);addCtrl.retainerDate = true;addCtrl.openDoi = false;addCtrl.openDointake = false">
                                <i class="default-calendar-small sprite"></i>
                            </button>
                        </span>
                    </div>
                    <div class="error" id="retainerDateError">Invalid date format!</div>
                    <div class="form-group" style="width:150px">
                        <label style="margin-top: 10px;">Retainer #</label>
                        <input type="text" style="width:100%;" format="number" amount-format maxlength="20" placeholder="Retainer #" ng-model="addCtrl.matterInfo.retainer_no"
                            name="retainer_no" class="form-control" />
                    </div>
                </div> -->
                <div class="clearfix">
                    <div class="col-md-12 court borderTop padding-left-0">
                        <h3 class="margin-top10px">Court Details</h3>
                        <div class="row">
                            <div class="clearfix"></div>

                            <div class="clearfix"></div>
                            <div class="col-lg-3 col-md-3  border-separator-right">
                                <div class="margin-top10px form-group" data-ng-form="addCtrl.addJurisdiction">
                                    <label>
                                        Jurisdiction
                                        <span class="compulsary-mark">*</span>
                                    </label>
                                    <ui-select name="jurisdiction" ng-required="true" on-select="addCtrl.setVenues(addCtrl.matterInfo.jurisdiction_id)" ng-model="addCtrl.matterInfo.jurisdiction_id"
                                        theme="selectize">
                                        <ui-select-match placeholder="Select Jurisdiction...">
                                            {{$select.selected.name}}
                                        </ui-select-match>
                                        <ui-select-choices repeat="jurisdiction.id as jurisdiction in addCtrl.jurisdictionList| filter:{name:$select.search} | orderBy: 'name'">
                                            <small>
                                                {{jurisdiction.name}}
                                            </small>
                                        </ui-select-choices>
                                    </ui-select>
                                </div>
                                <div class="form-group">
                                    <ui-select ng-model="addCtrl.matterInfo.court_id" on-select="addCtrl.getCourtContactList(addCtrl.matterInfo.court_id)" theme="selectize">
                                        <ui-select-match placeholder="Select Venue...">
                                            {{$select.selected.name}}
                                        </ui-select-match>
                                        <ui-select-choices repeat="venue.id as  venue in addCtrl.venues | filter:{name:$select.search} track by venue.id| orderBy: 'name'">
                                            <small>
                                                {{venue.name}}
                                            </small>
                                        </ui-select-choices>
                                    </ui-select>
                                </div>


                                <!--ng-if="addCtrl.courtContactList.length > 0" -->
                                <div ng-if="addCtrl.showCourt" class="form-group margin-top10px">
                                    <ui-select ng-model="addCtrl.matterInfo.court_contact_id" on-select="addCtrl.setCourtContactInfo(addCtrl.matterInfo.court_contact_id,addCtrl.courtContactList,addCtrl.matterInfo.court_contact_id.contactid)"
                                        theme="selectize">
                                        <ui-select-match placeholder="Select Court...">
                                            {{$select.selected.firstname}}
                                        </ui-select-match>
                                        <ui-select-choices group-by="addCtrl.groupCoutcontact" group-filter="addCtrl.test" repeat="courtContact in addCtrl.courtContactList | filter:{firstname:$select.search}">
                                            <small>
                                                {{courtContact.firstname}}
                                            </small>
                                            <br>
                                            <small class="court-contact">
                                                {{courtContact.street}} {{courtContact.city}} {{courtContact.zipcode}}
                                            </small>
                                        </ui-select-choices>
                                    </ui-select>
                                    <div class="margin-top10px">
                                        <div class="or-connector margin-top5px pull-left">OR</div>
                                        <button class="btn btn-default pull-right" data-ng-click="addCtrl.addNewCourtContact(addCtrl.matterInfo,addCtrl.matterInfo.court_id,'Court')">
                                            Add New
                                        </button>
                                    </div>

                                </div>
                            </div>

                            <div class="col-lg-4 col-md-4  address border-separator-right">
                                <label data-ng-show="addCtrl.courtContactList.length === 0 &&  addCtrl.display.courtContactDetailMsg">
                                    No court contact detail available
                                </label>

                                <label>
                                    {{addCtrl.courtDetailInfo.firstname + ' ' + addCtrl.courtDetailInfo.lastname}}
                                </label>
                                <p>{{addCtrl.courtDetailInfo.phone_work}}</p>
                                <address>
                                    {{addCtrl.courtDetailInfo.street}} {{addCtrl.courtDetailInfo.city}} {{addCtrl.courtDetailInfo.country}}
                                </address>
                            </div>
                            <div class="col-lg-5 col-md-5">
                                <div class="pull-left">
                                    <label> Assign to Subscribing Managing Partner: </label>
                                </div>
                                <div class="col-md-2 checkbox margin-top2px pull-left">
                                    <input type="checkbox" data-ng-model="addCtrl.matterInfo.smp_assigned" data-ng-true-value="'1'" data-ng-false-value="'0'"
                                        data-ng-disabled="false" />
                                    <label></label>
                                </div>

                                <div class="pull-left">
                                    <label> Assign to Me: </label>
                                </div>
                                <div class="col-md-2 checkbox margin-top2px pull-left">
                                    <input type="checkbox" data-ng-disabled="(addCtrl.mode === 'edit') && (addCtrl.matterCreater!= addCtrl.userId)" data-ng-model="addCtrl.matterInfo.creater_assigned"
                                        data-ng-true-value="'1'" data-ng-false-value="'0'" />
                                    <label></label>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="userAssignment borderTop form-group margin-top15px">

                        <div class="row margin-top10px">
                            <div class="col-md-6 ">
                                <h3>User Assignment </h3>

                            </div>
                            <div class="col-md-6">
                                <h3>Referral</h3>
                            </div>
                        </div>
                        <div class="row margin-top10px">
                            <div class="col-md-3">

                                <div class="row">
                                    <div class="col-md-12" data-ng-if="addCtrl.partner.length >= 0">
                                        <label>
                                            Managing Partner
                                        </label>
                                        <ui-select class="width100per z-index-select" multiple ng-model="addCtrl.matterInfo.managing_att_id" theme="select2">
                                            <ui-select-match placeholder="Select person...">
                                                {{$item.name}} {{$item.lname}}
                                            </ui-select-match>
                                            <ui-select-choices repeat="partner.uid as partner in addCtrl.partner| filter:{name:$select.search} | orderBy: 'name'">
                                                <small>{{partner.name}} {{partner.lname}}</small>
                                            </ui-select-choices>
                                        </ui-select>
                                    </div>
                                </div>
                                <div class="row margin-top10px">
                                    <div class="col-md-12" data-ng-if="addCtrl.attorneyList.length >= 0">
                                        <label>
                                            Lead Attorney
                                        </label>
                                        <ui-select class="width100per" multiple ng-model="addCtrl.matterInfo.leadattorny" theme="select2">
                                            <ui-select-match placeholder="Select person...">
                                                {{$item.name}} {{$item.lname}}
                                            </ui-select-match>
                                            <ui-select-choices repeat="leadAttorney.uid as leadAttorney in addCtrl.leadAttorneyList| filter:{name:$select.search} | orderBy: 'name'">
                                                <small>{{leadAttorney.name}} {{leadAttorney.lname}}</small>
                                            </ui-select-choices>
                                        </ui-select>
                                        <div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row margin-top10px">
                                    <div class="col-md-12" data-ng-if="addCtrl.attorneyList.length >= 0">
                                        <label>
                                            Attorney
                                        </label>
                                        <ui-select class="width100per" multiple ng-model="addCtrl.matterInfo.atterney_id" theme="select2">
                                            <ui-select-match placeholder="Select person...">
                                                {{$item.name}} {{$item.lname}}
                                            </ui-select-match>
                                            <ui-select-choices repeat="attorney.uid as attorney in addCtrl.attorneyList| filter:{name:$select.search} | orderBy: 'name'">
                                                <small>{{attorney.name}} {{attorney.lname}}</small>
                                            </ui-select-choices>
                                        </ui-select>
                                    </div>
                                </div>




                            </div>
                            <div class="col-md-3 border-separator-right">
                                <div class="row">
                                    <div class="col-md-12"></div>
                                    <div class="col-md-12" data-ng-if="addCtrl.paralegal.length>= 0">
                                        <label>
                                            Paralegal
                                        </label>
                                        <ui-select class="width100" multiple ng-model="addCtrl.matterInfo.paralegal" theme="select2" ng-disabled="disabled">
                                            <ui-select-match placeholder="Select person...">
                                                {{$item.name}} {{$item.lname}}
                                            </ui-select-match>
                                            <ui-select-choices repeat="paralegal.uid as paralegal in addCtrl.paralegal| filter:{name:$select.search} | orderBy: 'name'">
                                                <small>{{paralegal.name}} {{paralegal.lname}}</small>
                                            </ui-select-choices>
                                        </ui-select>
                                    </div>
                                </div>
                                <div class="row margin-top10px">
                                    <div class="col-md-12" data-ng-if="addCtrl.staffList.length >= 0">
                                        <label>
                                            Staff
                                        </label>
                                        <ui-select class="width100per" multiple ng-model="addCtrl.matterInfo.user_staff_id" theme="select2" ng-disabled="disabled">
                                            <ui-select-match ui-lock-choice="$item.name == 'Lexvia'" placeholder="Select person...">
                                                {{$item.name}} {{$item.lname}}
                                            </ui-select-match>
                                            <ui-select-choices repeat="staff.uid as staff in addCtrl.staffList| filter:{name:$select.search} | orderBy: 'name'">
                                                <small>{{staff.name}} {{staff.lname}}</small>
                                            </ui-select-choices>
                                        </ui-select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-md-12">

                                        <div class="row">
                                            <div class="col-md-6 ">
                                                <label>Referred To</label>
                                                <input type="text" data-ng-model="addCtrl.matterInfo.referred_to" data-ng-model-options="{ debounce: 500 }" placeholder="Enter referred to"
                                                    typeahead="row as row.name for row in addCtrl.getContacts($viewValue ,'refTo')"
                                                    typeahead-input-formatter="addCtrl.formatTypeaheadDisplay($model)" typeahead-loading="addCtrl.display.loadingRefrerredToId"
                                                    typeahead-template-url = "matter/matter-details/insaurance/contact-tpl.html"
                                                    class="form-control">

                                            </div>

                                            <div class="add-now-wrap col-md-6">
                                                <span class="or-connector">OR</span>
                                                <button class="btn btn-default" data-ng-click="addCtrl.addNewContact(addCtrl.matterInfo,'referred_to')">
                                                    Add New
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!--<script type="text/ng-template" id="typeahead-item.html">
                                <div class="typeahead-group-header" ng-if="match.model.firstInGroup"> {{match.model.contact_type}}</div>
                                <a>
                                    <span ng-bind-html="match.label | typeaheadHighlight:query"></span>
                                </a>
                                </script>-->
                                <div class="row margin-top10px">
                                    <div class="col-md-12">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Referred By</label>

                                                <input type="text" data-ng-model="addCtrl.matterInfo.referred_by" data-ng-model-options="{ debounce: 500 }" placeholder="Enter referred by"
                                                    typeahead="row as row.name for row in addCtrl.getContacts($viewValue ,'refBy')"
                                                    typeahead-input-formatter="addCtrl.formatTypeaheadDisplay($model)" typeahead-loading="addCtrl.display.loadingRefrerredById"
                                                    typeahead-template-url = "matter/matter-details/insaurance/contact-tpl.html"
                                                    class="form-control">
                                            </div>
                                            <div class="col-md-6">
                                                <div class="add-now-wrap">
                                                    <span class="or-connector">OR</span>
                                                    <button class="btn btn-default" data-ng-click="addCtrl.addNewContact(addCtrl.matterInfo,'referred_by')">
                                                        Add New
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                        </div>
                        <div class="row">
                        </div>

                        <div class="container"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer height-30px">
            </div>
        </div>
    </div>


    <!-- <div class=" col-md-3"
                            data-ng-if="addCtrl.partner.length>= 0">
                            <label>
                                Managing Partner {{addCtrl.matterInfo.managing_att_id}}
                            </label>
                            <ui-select
                                name="mp"
                                ng-model="addCtrl.matterInfo.managing_att_id"
                                theme="selectize">
                                    <ui-select-match placeholder="Select person...">
                                    {{$select.selected.name}}
                                </ui-select-match>
                                    <ui-select-choices
                                        repeat="partner.uid as partner in addCtrl.partner| filter:{name:$select.search} track by $index">
                                <small>
                                    {{partner.name}}
                                </small>
                            </ui-select-choices>
                          </ui-select>
                        </div>-->